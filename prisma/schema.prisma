generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model auth_base_user {
  id             String                 @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  user_name      String?                @unique(map: "auth_base_user_pk") @db.VarChar(255)
  full_name      String?                @db.VarChar(255)
  email          String?                @db.VarChar(255)
  phone_number   String?                @db.Char(10)
  password_hash  String?                @db.VarChar(255)
  address        String?                @db.VarChar(255)
  description    String?                @db.VarChar(255)
  latest_login   DateTime?              @db.Timestamp(0)
  login_attempts Int?
  lockout_util   DateTime?              @db.Timestamp(0)
  status         auth_base_user_status? @default(INACTIVE)
  created_at     DateTime?              @default(now()) @db.Timestamp(0)
  updated_at     DateTime?              @default(now()) @db.Timestamp(0)
  group_id       String?                @db.VarChar(36)
  last_seen_at   DateTime?              @db.Timestamp(0)

  @@index([email], map: "idx_email")
  @@index([phone_number], map: "idx_phone_number")
  @@index([full_name], map: "idx_full_name")
  @@index([group_id], map: "idx_group_id")
  @@index([last_seen_at], map: "idx_last_seen")
  @@index([status], map: "idx_status")
}

model auth_refresh_tokens {
  id         String    @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  token_id   String?   @unique(map: "token_id") @db.VarChar(255)
  token_hash String?   @db.VarChar(255)
  user_id    String?   @db.VarChar(36)
  expires_at DateTime? @db.Timestamp(0)
  revoked_at DateTime? @db.Timestamp(0)
  ip_address String?   @db.VarChar(45)
  user_agent String?   @db.Text
  created_at DateTime? @default(now()) @db.Timestamp(0)
  updated_at DateTime? @default(now()) @db.Timestamp(0)

  @@index([expires_at], map: "idx_expires")
  @@index([revoked_at], map: "idx_revoked")
  @@index([token_id], map: "idx_token_id")
  @@index([user_id], map: "idx_user")
  @@index([user_id, expires_at], map: "idx_user_expires")
}

model system_setting {
  id            String    @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  name_setting  String?   @unique(map: "system_setting_pk") @db.VarChar(255)
  value_setting String?   @db.VarChar(255)
  created_at    DateTime? @default(now()) @db.Timestamp(0)
  updated_at    DateTime? @default(now()) @db.Timestamp(0)
}

model auth_impl_user_student {
  id              String     @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  user_id         String?    @db.VarChar(36)
  school_id       String?    @db.VarChar(36)
  class_id        String?    @db.VarChar(36)
  sex             sex_enum?
  birthday        DateTime?  @db.Date
  description     String?    @db.Text
  major_interest  String?    @db.Text
  created_at      DateTime?  @default(now()) @db.Timestamp(0)
  updated_at      DateTime?  @default(now()) @db.Timestamp(0)

  @@index([user_id], map: "idx_user_id")
  @@index([school_id], map: "idx_school_id")
  @@index([class_id], map: "idx_class_id")
  @@index([sex], map: "idx_sex")
  @@index([birthday], map: "idx_birthday")
}

enum auth_base_user_status {
  ACTIVE
  INACTIVE
  BANNER
}

model auth_impl_user_school {
  id          String    @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  user_id     String?   @db.VarChar(36)
  school_id   String?   @db.VarChar(36)
  description String?   @db.Text
  created_at  DateTime? @default(now()) @db.Timestamp(0)
  updated_at  DateTime? @default(now()) @db.Timestamp(0)

  @@index([user_id], map: "idx_user_id")
  @@index([school_id], map: "idx_school_id")
  @@index([user_id, school_id], map: "idx_user_school")
}

model auth_group {
  id          String    @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  name        String?   @db.VarChar(255)
  description String?   @db.VarChar(255)
  type        String?   @db.VarChar(255)
  created_at  DateTime? @default(now()) @db.Timestamp(0)
  updated_at  DateTime? @default(now()) @db.Timestamp(0)

  @@index([name], map: "idx_name")
  @@index([type], map: "idx_type")
}

model auth_role {
  id          String    @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  group_id    String?   @db.VarChar(36)
  name        String?   @db.VarChar(255)
  description String?   @db.Text
  created_at  DateTime? @default(now()) @db.Timestamp(0)
  updated_at  DateTime? @default(now()) @db.Timestamp(0)

  @@index([group_id], map: "idx_group_id")
  @@index([name], map: "idx_name")
  @@index([group_id, name], map: "idx_group_name")
}

model student_logs {
  id         String    @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  student_id String?   @db.VarChar(36)
  type       String?   @db.VarChar(255)
  content    String?   @db.Text
  created_at DateTime? @default(now()) @db.Timestamp(0)
  updated_at DateTime? @default(now()) @db.Timestamp(0)

  @@index([student_id], map: "idx_student_id")
  @@index([type], map: "idx_type")
  @@index([created_at], map: "idx_created_at")
  @@index([student_id, type], map: "idx_student_type")
}

model schools {
  id           String    @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  name         String?   @db.VarChar(255)
  address      String?   @db.VarChar(255)
  contact_email String?  @db.VarChar(255)
  phone_number String?   @db.VarChar(20)
  created_at   DateTime? @default(now()) @db.Timestamp(0)
  updated_at   DateTime? @default(now()) @db.Timestamp(0)

  @@index([name], map: "idx_name")
  @@index([contact_email], map: "idx_contact_email")
  @@index([phone_number], map: "idx_phone_number")
}

model classes {
  id                    String    @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  name                  String?   @db.VarChar(255)
  grade_level           Int?
  school_id             String?   @db.VarChar(36)
  homeroom_teacher_id   String?   @db.VarChar(36)
  created_at            DateTime? @default(now()) @db.Timestamp(0)
  updated_at            DateTime? @default(now()) @db.Timestamp(0)

  @@index([name], map: "idx_name")
  @@index([grade_level], map: "idx_grade_level")
  @@index([school_id], map: "idx_school_id")
  @@index([homeroom_teacher_id], map: "idx_homeroom_teacher_id")
  @@index([school_id, grade_level], map: "idx_school_grade")
}

model commune {
  id          String    @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  name        String?   @db.VarChar(255)
  province_id String?   @db.VarChar(36)
  created_at  DateTime? @default(now()) @db.Timestamp(0)
  updated_at  DateTime? @default(now()) @db.Timestamp(0)

  @@index([name], map: "idx_name")
  @@index([province_id], map: "idx_province_id")
}

model province {
  id         String    @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  name       String?   @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  updated_at DateTime? @default(now()) @db.Timestamp(0)

  @@index([name], map: "idx_name")
}

enum sex_enum {
  OTHER @map("0")
  MALE  @map("1") 
  FEMALE @map("2")
}
